# Docker S3 Instance Profile æµ‹è¯• - æœ¬åœ°æ‰“åŒ…æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°
ç”±äº EC2 å®ä¾‹æ— æ³•è®¿é—® Docker Hubï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°æ„å»º Docker é•œåƒï¼Œç„¶åä¼ è¾“åˆ° EC2 è¿›è¡Œæµ‹è¯•ã€‚

## ğŸš€ æ“ä½œæ­¥éª¤

### æ­¥éª¤ 1: æœ¬åœ°æ„å»º Docker é•œåƒ

åœ¨æ‚¨çš„æœ¬åœ°ç”µè„‘ä¸Šï¼š

```bash
# è¿›å…¥æµ‹è¯•ç›®å½•
cd /tmp/docker-s3-test

# æ„å»ºå¹¶ä¿å­˜ Docker é•œåƒ
chmod +x build_and_save.sh
./build_and_save.sh
```

è¿™å°†åˆ›å»ºä¸€ä¸ª `s3-test-image.tar` æ–‡ä»¶ã€‚

### æ­¥éª¤ 2: æ‰‹åŠ¨ä¸Šä¼ åˆ° EC2

#### æ–¹æ³• A: ä½¿ç”¨ SCP ä¸Šä¼ 
```bash
# æ›¿æ¢ your-key.pem ä¸ºæ‚¨çš„å®é™…å¯†é’¥æ–‡ä»¶è·¯å¾„
scp -i your-key.pem s3-test-image.tar ec2-user@52.81.92.36:~/
```

#### æ–¹æ³• B: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬
```bash
# å…ˆç¼–è¾‘ upload_to_ec2.shï¼Œä¿®æ”¹ KEY_FILE å˜é‡
chmod +x upload_to_ec2.sh
./upload_to_ec2.sh
```

### æ­¥éª¤ 3: åœ¨ EC2 ä¸ŠåŠ è½½å¹¶æµ‹è¯•

SSH è¿æ¥åˆ° EC2ï¼š
```bash
ssh -i your-key.pem ec2-user@52.81.92.36
```

åœ¨ EC2 ä¸Šæ‰§è¡Œï¼š
```bash
# åŠ è½½ Docker é•œåƒ
sudo docker load -i s3-test-image.tar

# éªŒè¯é•œåƒåŠ è½½
sudo docker images | grep s3-test

# è¿è¡Œæµ‹è¯•
sudo docker run --rm s3-test:latest

# æ¸…ç†
rm -f s3-test-image.tar
```

## ğŸ“º é¢„æœŸæµ‹è¯•ç»“æœ

æˆåŠŸæ—¶çš„æ˜¾ç¤ºï¼š
```
============================================================
æµ‹è¯• Docker å®¹å™¨ä¸­çš„ Instance Profile è®¿é—® S3
æµ‹è¯•æ—¶é—´: 2025-08-06 13:15:30.123456
============================================================

1. æµ‹è¯• boto3 S3 è®¿é—®...
âœ… Docker å®¹å™¨ä¸­ S3 è®¿é—®æˆåŠŸï¼
   å…±æœ‰ 90 ä¸ªå­˜å‚¨æ¡¶

   å­˜å‚¨æ¡¶åˆ—è¡¨ï¼ˆå‰3ä¸ªï¼‰:
     - ab2webfront
     - ai-customer-service-apiconstructllmbotdocumentsfc4-i1qr5xylunsj
     - ai-customer-service-apiconstructllmbotdocumentsfc4-ww2owsajcmay

2. æµ‹è¯•å…ƒæ•°æ®æœåŠ¡è®¿é—®...
âœ… å…ƒæ•°æ®æœåŠ¡è®¿é—®æˆåŠŸ
âœ… è§’è‰²åç§°: PVRE-SSMOnboardingRole-K4CRSMYV2BU9

3. æµ‹è¯•èº«ä»½ä¿¡æ¯...
âœ… å½“å‰èº«ä»½:
   è´¦æˆ·ID: 994626867605
   ARN: arn:aws-cn:sts::994626867605:assumed-role/PVRE-SSMOnboardingRole-K4CRSMYV2BU9/i-07f41015322e2403c

============================================================
ğŸ‰ Docker å®¹å™¨æµ‹è¯•æˆåŠŸï¼æ–¹æ³•ä¸€åœ¨å®¹å™¨ä¸­ä¹Ÿæ­£å¸¸å·¥ä½œï¼
============================================================
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¦‚æœé‡åˆ°æƒé™é”™è¯¯ï¼š
```bash
# ç¡®ä¿ ec2-user åœ¨ docker ç»„ä¸­
sudo usermod -a -G docker ec2-user
# é‡æ–°ç™»å½•æˆ–ä½¿ç”¨ sudo
```

### å¦‚æœé‡åˆ°ç½‘ç»œé”™è¯¯ï¼š
- æ£€æŸ¥ EC2 å®‰å…¨ç»„æ˜¯å¦å…è®¸å‡ºç«™æµé‡
- ç¡®è®¤å®ä¾‹å¯ä»¥è®¿é—®å…ƒæ•°æ®æœåŠ¡ (169.254.169.254)

### å¦‚æœ boto3 å¯¼å…¥å¤±è´¥ï¼š
```bash
# åœ¨ EC2 ä¸Šå®‰è£… boto3ï¼ˆå¦‚æœä¹‹å‰å®‰è£…å¤±è´¥ï¼‰
sudo yum install -y python3-pip
pip3 install --user boto3 requests
```

## ğŸ“ æ–‡ä»¶è¯´æ˜

- `Dockerfile`: Docker é•œåƒæ„å»ºæ–‡ä»¶
- `test_docker_s3.py`: Docker å®¹å™¨å†…çš„æµ‹è¯•è„šæœ¬
- `build_and_save.sh`: æœ¬åœ°æ„å»ºå’Œä¿å­˜é•œåƒçš„è„šæœ¬
- `upload_to_ec2.sh`: è‡ªåŠ¨ä¸Šä¼ åˆ° EC2 çš„è„šæœ¬
- `README.md`: æœ¬è¯´æ˜æ–‡ä»¶

## ğŸ¯ æµ‹è¯•ç›®æ ‡

è¿™ä¸ªæµ‹è¯•å°†éªŒè¯ï¼š
1. âœ… Docker å®¹å™¨å¯ä»¥ç»§æ‰¿ EC2 çš„ Instance Profile
2. âœ… boto3 åœ¨å®¹å™¨ä¸­è‡ªåŠ¨è·å–å‡­è¯
3. âœ… å®¹å™¨å¯ä»¥è®¿é—®å…ƒæ•°æ®æœåŠ¡
4. âœ… S3 è®¿é—®æƒé™æ­£å¸¸å·¥ä½œ
5. âœ… æ–¹æ³•ä¸€ï¼ˆç›´æ¥ç»§æ‰¿ï¼‰çš„å¯è¡Œæ€§
